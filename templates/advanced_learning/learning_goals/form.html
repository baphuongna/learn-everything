{% extends 'base/base.html' %}
{% load static %}

{% block title %}{% if is_create %}Tạo Mục Tiêu Học Tập{% else %}Chỉnh Sửa Mục Tiêu Học Tập{% endif %}{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .form-card {
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    
    .form-header {
        background-color: #6f42c1;
        color: white;
        padding: 15px 20px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    
    .form-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0;
    }
    
    .form-body {
        padding: 20px;
    }
    
    .goal-type-card {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .goal-type-card:hover {
        background-color: #f8f9fa;
    }
    
    .goal-type-card.selected {
        border-color: #6f42c1;
        background-color: #f3ebff;
    }
    
    .goal-type-title {
        font-weight: 600;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
    }
    
    .goal-type-title i {
        margin-right: 10px;
        color: #6f42c1;
    }
    
    .goal-type-description {
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .goal-metric-card {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .goal-metric-card:hover {
        background-color: #f8f9fa;
    }
    
    .goal-metric-card.selected {
        border-color: #6f42c1;
        background-color: #f3ebff;
    }
    
    .goal-metric-title {
        font-weight: 600;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
    }
    
    .goal-metric-title i {
        margin-right: 10px;
        color: #6f42c1;
    }
    
    .goal-metric-description {
        font-size: 0.9rem;
        color: #6c757d;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="mb-3">
            <i class="fas fa-bullseye text-purple"></i> {% if is_create %}Tạo Mục Tiêu Học Tập{% else %}Chỉnh Sửa Mục Tiêu Học Tập{% endif %}
        </h1>
        <p class="lead">{% if is_create %}Tạo mục tiêu học tập mới để theo dõi tiến độ của bạn.{% else %}Chỉnh sửa thông tin mục tiêu học tập.{% endif %}</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="{% url 'advanced_learning:learning_goals' %}" class="btn btn-outline-purple">
            <i class="fas fa-arrow-left"></i> Quay Lại Danh Sách
        </a>
    </div>
</div>

<div class="form-container">
    <form method="post">
        {% csrf_token %}
        
        <div class="card form-card">
            <div class="form-header">
                <h5 class="form-title">Thông Tin Mục Tiêu</h5>
            </div>
            <div class="form-body">
                <div class="mb-3">
                    <label for="{{ form.title.id_for_label }}" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
                    {{ form.title }}
                    {% if form.title.errors %}
                    <div class="text-danger">
                        {% for error in form.title.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="{{ form.description.id_for_label }}" class="form-label">Mô tả</label>
                    {{ form.description }}
                    {% if form.description.errors %}
                    <div class="text-danger">
                        {% for error in form.description.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Loại mục tiêu <span class="text-danger">*</span></label>
                    
                    <div class="goal-type-card" data-type="daily">
                        <div class="goal-type-title">
                            <i class="fas fa-calendar-day"></i> Hàng ngày
                        </div>
                        <div class="goal-type-description">
                            Mục tiêu cần đạt được mỗi ngày.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-type-radio" type="radio" name="goal_type" id="type-daily" value="daily" {% if form.goal_type.value == 'daily' %}checked{% endif %}>
                            <label class="form-check-label" for="type-daily">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-type-card" data-type="weekly">
                        <div class="goal-type-title">
                            <i class="fas fa-calendar-week"></i> Hàng tuần
                        </div>
                        <div class="goal-type-description">
                            Mục tiêu cần đạt được mỗi tuần.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-type-radio" type="radio" name="goal_type" id="type-weekly" value="weekly" {% if form.goal_type.value == 'weekly' %}checked{% endif %}>
                            <label class="form-check-label" for="type-weekly">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-type-card" data-type="monthly">
                        <div class="goal-type-title">
                            <i class="fas fa-calendar-alt"></i> Hàng tháng
                        </div>
                        <div class="goal-type-description">
                            Mục tiêu cần đạt được mỗi tháng.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-type-radio" type="radio" name="goal_type" id="type-monthly" value="monthly" {% if form.goal_type.value == 'monthly' %}checked{% endif %}>
                            <label class="form-check-label" for="type-monthly">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-type-card" data-type="custom">
                        <div class="goal-type-title">
                            <i class="fas fa-calendar-plus"></i> Tùy chỉnh
                        </div>
                        <div class="goal-type-description">
                            Mục tiêu với khoảng thời gian tùy chỉnh.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-type-radio" type="radio" name="goal_type" id="type-custom" value="custom" {% if form.goal_type.value == 'custom' %}checked{% endif %}>
                            <label class="form-check-label" for="type-custom">
                                Chọn
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Chỉ số đo lường <span class="text-danger">*</span></label>
                    
                    <div class="goal-metric-card" data-metric="study_time">
                        <div class="goal-metric-title">
                            <i class="fas fa-clock"></i> Thời gian học tập
                        </div>
                        <div class="goal-metric-description">
                            Số phút học tập.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-metric-radio" type="radio" name="goal_metric" id="metric-study_time" value="study_time" {% if form.goal_metric.value == 'study_time' %}checked{% endif %}>
                            <label class="form-check-label" for="metric-study_time">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-metric-card" data-metric="notes_count">
                        <div class="goal-metric-title">
                            <i class="fas fa-sticky-note"></i> Số ghi chú
                        </div>
                        <div class="goal-metric-description">
                            Số lượng ghi chú tạo ra.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-metric-radio" type="radio" name="goal_metric" id="metric-notes_count" value="notes_count" {% if form.goal_metric.value == 'notes_count' %}checked{% endif %}>
                            <label class="form-check-label" for="metric-notes_count">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-metric-card" data-metric="mindmaps_count">
                        <div class="goal-metric-title">
                            <i class="fas fa-project-diagram"></i> Số mind map
                        </div>
                        <div class="goal-metric-description">
                            Số lượng mind map tạo ra.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-metric-radio" type="radio" name="goal_metric" id="metric-mindmaps_count" value="mindmaps_count" {% if form.goal_metric.value == 'mindmaps_count' %}checked{% endif %}>
                            <label class="form-check-label" for="metric-mindmaps_count">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-metric-card" data-metric="projects_progress">
                        <div class="goal-metric-title">
                            <i class="fas fa-tasks"></i> Tiến độ dự án
                        </div>
                        <div class="goal-metric-description">
                            Phần trăm tiến độ dự án.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-metric-radio" type="radio" name="goal_metric" id="metric-projects_progress" value="projects_progress" {% if form.goal_metric.value == 'projects_progress' %}checked{% endif %}>
                            <label class="form-check-label" for="metric-projects_progress">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-metric-card" data-metric="exercises_completed">
                        <div class="goal-metric-title">
                            <i class="fas fa-dumbbell"></i> Số bài tập
                        </div>
                        <div class="goal-metric-description">
                            Số lượng bài tập hoàn thành.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-metric-radio" type="radio" name="goal_metric" id="metric-exercises_completed" value="exercises_completed" {% if form.goal_metric.value == 'exercises_completed' %}checked{% endif %}>
                            <label class="form-check-label" for="metric-exercises_completed">
                                Chọn
                            </label>
                        </div>
                    </div>
                    
                    <div class="goal-metric-card" data-metric="competition_points">
                        <div class="goal-metric-title">
                            <i class="fas fa-trophy"></i> Điểm thi đấu
                        </div>
                        <div class="goal-metric-description">
                            Số điểm thi đấu đạt được.
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input goal-metric-radio" type="radio" name="goal_metric" id="metric-competition_points" value="competition_points" {% if form.goal_metric.value == 'competition_points' %}checked{% endif %}>
                            <label class="form-check-label" for="metric-competition_points">
                                Chọn
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="{{ form.target_value.id_for_label }}" class="form-label">Giá trị mục tiêu <span class="text-danger">*</span></label>
                    {{ form.target_value }}
                    {% if form.target_value.errors %}
                    <div class="text-danger">
                        {% for error in form.target_value.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="form-text">Giá trị cần đạt được để hoàn thành mục tiêu.</div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.start_date.id_for_label }}" class="form-label">Ngày bắt đầu <span class="text-danger">*</span></label>
                            {{ form.start_date }}
                            {% if form.start_date.errors %}
                            <div class="text-danger">
                                {% for error in form.start_date.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.end_date.id_for_label }}" class="form-label">Ngày kết thúc</label>
                            {{ form.end_date }}
                            {% if form.end_date.errors %}
                            <div class="text-danger">
                                {% for error in form.end_date.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            <div class="form-text">Để trống nếu không có ngày kết thúc cụ thể.</div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="{{ form.subject.id_for_label }}" class="form-label">Môn học</label>
                    {{ form.subject }}
                    {% if form.subject.errors %}
                    <div class="text-danger">
                        {% for error in form.subject.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="form-text">Chọn môn học liên quan đến mục tiêu (nếu có).</div>
                </div>
                
                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-purple">
                        <i class="fas fa-save"></i> {% if is_create %}Tạo Mục Tiêu{% else %}Lưu Thay Đổi{% endif %}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Xử lý chọn loại mục tiêu
        const goalTypeCards = document.querySelectorAll('.goal-type-card');
        const goalTypeRadios = document.querySelectorAll('.goal-type-radio');
        
        goalTypeCards.forEach(card => {
            card.addEventListener('click', function() {
                const type = this.dataset.type;
                const radio = document.getElementById('type-' + type);
                
                // Bỏ chọn tất cả các thẻ
                goalTypeCards.forEach(c => c.classList.remove('selected'));
                
                // Chọn thẻ hiện tại
                this.classList.add('selected');
                
                // Chọn radio button
                radio.checked = true;
            });
        });
        
        // Xử lý chọn chỉ số đo lường
        const goalMetricCards = document.querySelectorAll('.goal-metric-card');
        const goalMetricRadios = document.querySelectorAll('.goal-metric-radio');
        
        goalMetricCards.forEach(card => {
            card.addEventListener('click', function() {
                const metric = this.dataset.metric;
                const radio = document.getElementById('metric-' + metric);
                
                // Bỏ chọn tất cả các thẻ
                goalMetricCards.forEach(c => c.classList.remove('selected'));
                
                // Chọn thẻ hiện tại
                this.classList.add('selected');
                
                // Chọn radio button
                radio.checked = true;
            });
        });
        
        // Chọn loại mục tiêu mặc định
        const selectedGoalType = document.querySelector('.goal-type-radio:checked');
        if (selectedGoalType) {
            const type = selectedGoalType.value;
            document.querySelector(`.goal-type-card[data-type="${type}"]`).classList.add('selected');
        } else {
            document.querySelector('.goal-type-card[data-type="daily"]').classList.add('selected');
            document.getElementById('type-daily').checked = true;
        }
        
        // Chọn chỉ số đo lường mặc định
        const selectedGoalMetric = document.querySelector('.goal-metric-radio:checked');
        if (selectedGoalMetric) {
            const metric = selectedGoalMetric.value;
            document.querySelector(`.goal-metric-card[data-metric="${metric}"]`).classList.add('selected');
        } else {
            document.querySelector('.goal-metric-card[data-metric="study_time"]').classList.add('selected');
            document.getElementById('metric-study_time').checked = true;
        }
    });
</script>
{% endblock %}
