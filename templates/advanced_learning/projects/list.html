{% extends 'base/base.html' %}
{% load static %}

{% block title %}Dự Án Học Tập - Nền Tảng Học Tập{% endblock %}

{% block extra_css %}
<style>
    .project-card {
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        margin-bottom: 15px;
        border-left: 4px solid #17a2b8;
    }
    
    .project-card:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .project-title {
        font-weight: 600;
        color: #17a2b8;
    }
    
    .project-meta {
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    .project-description {
        max-height: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .search-card {
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
    }
    
    .empty-state i {
        font-size: 4rem;
        color: #dee2e6;
        margin-bottom: 20px;
    }
    
    .difficulty-badge {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
    }
    
    .difficulty-1 {
        background-color: #28a745;
    }
    
    .difficulty-2 {
        background-color: #ffc107;
    }
    
    .difficulty-3 {
        background-color: #dc3545;
    }
    
    .project-stats {
        display: flex;
        gap: 15px;
        margin-top: 10px;
    }
    
    .project-stat {
        display: flex;
        align-items: center;
        font-size: 0.9rem;
    }
    
    .project-stat i {
        margin-right: 5px;
        color: #17a2b8;
    }
    
    .tab-content {
        padding-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="mb-3">
            <i class="fas fa-tasks text-info"></i> Dự Án Học Tập
        </h1>
        <p class="lead">Học tập thông qua các dự án thực tế, giúp bạn áp dụng kiến thức vào thực tiễn.</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="{% url 'advanced_learning:my_projects' %}" class="btn btn-info">
            <i class="fas fa-user"></i> Dự Án Của Tôi
        </a>
    </div>
</div>

<!-- Tabs -->
<ul class="nav nav-tabs mb-4" id="projectTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-projects-tab" data-bs-toggle="tab" data-bs-target="#all-projects" type="button" role="tab" aria-controls="all-projects" aria-selected="true">
            <i class="fas fa-list"></i> Tất Cả Dự Án
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="my-projects-tab" data-bs-toggle="tab" data-bs-target="#my-projects" type="button" role="tab" aria-controls="my-projects" aria-selected="false">
            <i class="fas fa-user-check"></i> Dự Án Đã Tham Gia
        </button>
    </li>
</ul>

<div class="tab-content" id="projectTabsContent">
    <!-- Tất cả dự án -->
    <div class="tab-pane fade show active" id="all-projects" role="tabpanel" aria-labelledby="all-projects-tab">
        <!-- Tìm kiếm và lọc -->
        <div class="card search-card mb-4">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-4">
                        <div class="input-group">
                            <input type="text" class="form-control" name="search" placeholder="Tìm kiếm dự án..." value="{{ search_query }}">
                            <button class="btn btn-info" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="subject" onchange="this.form.submit()">
                            <option value="">Tất cả chủ đề</option>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}" {% if selected_subject == subject.id|stringformat:"i" %}selected{% endif %}>
                                {{ subject.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="difficulty" onchange="this.form.submit()">
                            <option value="">Tất cả độ khó</option>
                            <option value="1" {% if selected_difficulty == '1' %}selected{% endif %}>Dễ</option>
                            <option value="2" {% if selected_difficulty == '2' %}selected{% endif %}>Trung bình</option>
                            <option value="3" {% if selected_difficulty == '3' %}selected{% endif %}>Khó</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        {% if search_query or selected_subject or selected_difficulty %}
                        <a href="{% url 'advanced_learning:project_list' %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-times"></i> Xóa bộ lọc
                        </a>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>

        <!-- Danh sách dự án -->
        <div class="row">
            <div class="col-md-12">
                {% if projects %}
                    {% for project in projects %}
                    <div class="card project-card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 class="project-title">{{ project.title }}</h5>
                                    <p class="project-meta">
                                        {% if project.subject %}
                                        <span class="badge bg-primary">{{ project.subject.name }}</span>
                                        {% endif %}
                                        <span class="badge {% if project.difficulty_level == 1 %}bg-success{% elif project.difficulty_level == 2 %}bg-warning{% else %}bg-danger{% endif %} difficulty-badge">
                                            {% if project.difficulty_level == 1 %}
                                                Dễ
                                            {% elif project.difficulty_level == 2 %}
                                                Trung bình
                                            {% else %}
                                                Khó
                                            {% endif %}
                                        </span>
                                    </p>
                                    <div class="project-description">
                                        {{ project.description|truncatechars:200 }}
                                    </div>
                                    <div class="project-stats">
                                        <div class="project-stat">
                                            <i class="fas fa-tasks"></i> {{ project.task_count }} nhiệm vụ
                                        </div>
                                        <div class="project-stat">
                                            <i class="fas fa-clock"></i> {{ project.estimated_hours }} giờ
                                        </div>
                                        <div class="project-stat">
                                            <i class="fas fa-users"></i> {{ project.user_projects.count }} người tham gia
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end d-flex align-items-center justify-content-end">
                                    <a href="{% url 'advanced_learning:project_detail' project_id=project.id %}" class="btn btn-outline-info me-2">
                                        <i class="fas fa-eye"></i> Xem
                                    </a>
                                    {% if project.id in user_project_ids %}
                                        <button class="btn btn-outline-secondary" disabled>
                                            <i class="fas fa-check"></i> Đã tham gia
                                        </button>
                                    {% else %}
                                        <a href="{% url 'advanced_learning:start_project' project_id=project.id %}" class="btn btn-info">
                                            <i class="fas fa-play"></i> Bắt đầu
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="card">
                        <div class="card-body empty-state">
                            <i class="fas fa-tasks"></i>
                            <h4>Không có dự án nào</h4>
                            <p class="text-muted">Không tìm thấy dự án nào phù hợp với tiêu chí tìm kiếm của bạn.</p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Dự án đã tham gia -->
    <div class="tab-pane fade" id="my-projects" role="tabpanel" aria-labelledby="my-projects-tab">
        <div class="row">
            <div class="col-md-12">
                {% if user_projects %}
                    {% for user_project in user_projects %}
                    <div class="card project-card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 class="project-title">{{ user_project.project.title }}</h5>
                                    <p class="project-meta">
                                        {% if user_project.project.subject %}
                                        <span class="badge bg-primary">{{ user_project.project.subject.name }}</span>
                                        {% endif %}
                                        <span class="badge {% if user_project.project.difficulty_level == 1 %}bg-success{% elif user_project.project.difficulty_level == 2 %}bg-warning{% else %}bg-danger{% endif %} difficulty-badge">
                                            {% if user_project.project.difficulty_level == 1 %}
                                                Dễ
                                            {% elif user_project.project.difficulty_level == 2 %}
                                                Trung bình
                                            {% else %}
                                                Khó
                                            {% endif %}
                                        </span>
                                        <span class="badge {% if user_project.status == 'not_started' %}bg-secondary{% elif user_project.status == 'in_progress' %}bg-primary{% else %}bg-success{% endif %} ms-1">
                                            {% if user_project.status == 'not_started' %}
                                                Chưa bắt đầu
                                            {% elif user_project.status == 'in_progress' %}
                                                Đang thực hiện
                                            {% else %}
                                                Đã hoàn thành
                                            {% endif %}
                                        </span>
                                    </p>
                                    <div class="progress mb-2" style="height: 10px;">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: {{ user_project.progress }}%;" aria-valuenow="{{ user_project.progress }}" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="project-stats">
                                        <div class="project-stat">
                                            <i class="fas fa-tasks"></i> {{ user_project.project.tasks.count }} nhiệm vụ
                                        </div>
                                        <div class="project-stat">
                                            <i class="fas fa-clock"></i> {{ user_project.project.estimated_hours }} giờ
                                        </div>
                                        <div class="project-stat">
                                            <i class="fas fa-calendar-alt"></i> Bắt đầu: {{ user_project.started_at|date:"d/m/Y" }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end d-flex align-items-center justify-content-end">
                                    <a href="{% url 'advanced_learning:project_detail' project_id=user_project.project.id %}" class="btn btn-outline-info me-2">
                                        <i class="fas fa-eye"></i> Xem
                                    </a>
                                    <a href="{% url 'advanced_learning:update_project_progress' project_id=user_project.project.id %}" class="btn btn-info">
                                        <i class="fas fa-sync-alt"></i> Cập nhật
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="card">
                        <div class="card-body empty-state">
                            <i class="fas fa-user-graduate"></i>
                            <h4>Bạn chưa tham gia dự án nào</h4>
                            <p class="text-muted">Hãy bắt đầu một dự án để áp dụng kiến thức vào thực tiễn!</p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Thông tin về học tập dựa trên dự án -->
<div class="row mt-5">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Về Học Tập Dựa Trên Dự Án</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Học tập dựa trên dự án là gì?</h5>
                        <p>Học tập dựa trên dự án (Project-Based Learning - PBL) là một phương pháp giảng dạy trong đó người học thu nhận kiến thức và kỹ năng bằng cách làm việc trong một khoảng thời gian để điều tra và phản hồi một câu hỏi, vấn đề, hoặc thách thức thực tế, hấp dẫn và phức tạp.</p>
                    </div>
                    <div class="col-md-6">
                        <h5>Lợi ích của học tập dựa trên dự án:</h5>
                        <ul>
                            <li><strong>Tăng động lực học tập:</strong> Học viên được tham gia vào các dự án thực tế, có ý nghĩa.</li>
                            <li><strong>Phát triển kỹ năng giải quyết vấn đề:</strong> Đối mặt với các thách thức thực tế và tìm ra giải pháp.</li>
                            <li><strong>Cải thiện khả năng làm việc nhóm:</strong> Học cách hợp tác, giao tiếp và chia sẻ ý tưởng.</li>
                            <li><strong>Áp dụng kiến thức vào thực tiễn:</strong> Kết nối lý thuyết với thực hành.</li>
                            <li><strong>Phát triển tư duy phản biện:</strong> Phân tích, đánh giá và tổng hợp thông tin.</li>
                        </ul>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <h5>Các bước thực hiện một dự án học tập:</h5>
                        <ol>
                            <li><strong>Xác định câu hỏi hoặc vấn đề:</strong> Bắt đầu với một câu hỏi hướng dẫn hoặc vấn đề cần giải quyết.</li>
                            <li><strong>Lập kế hoạch:</strong> Xác định các nhiệm vụ, nguồn lực và thời gian cần thiết.</li>
                            <li><strong>Nghiên cứu và thu thập thông tin:</strong> Tìm kiếm và thu thập thông tin liên quan đến vấn đề.</li>
                            <li><strong>Phát triển giải pháp:</strong> Áp dụng kiến thức và kỹ năng để phát triển giải pháp.</li>
                            <li><strong>Thực hiện và điều chỉnh:</strong> Thực hiện giải pháp và điều chỉnh khi cần thiết.</li>
                            <li><strong>Đánh giá và phản ánh:</strong> Đánh giá kết quả và phản ánh về quá trình học tập.</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Xử lý chuyển tab
        const urlParams = new URLSearchParams(window.location.search);
        const tab = urlParams.get('tab');
        
        if (tab === 'my-projects') {
            const myProjectsTab = document.getElementById('my-projects-tab');
            myProjectsTab.click();
        }
    });
</script>
{% endblock %}
